<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    {{ bootstrap.load_css() }}
    <title>{% block title %}案件検索ツール{% endblock %}</title>
    
    <!-- beforeunloadによるサーバーシャットダウン処理 -->
    <script>
        // 初期状態：サーバーシャットダウンを許可
        window.__skipBeforeUnload = false;
        // ユーザー操作（クリック、キー押下、マウスダウン、タッチ開始）が発生した場合はシャットダウンをスキップ
        ['click', 'keydown', 'mousedown', 'touchstart'].forEach(evt => {
            document.addEventListener(evt, () => { window.__skipBeforeUnload = true; });
        });
        // ログイン関連ページ（/login, /auth/callback等）では送信を常にスキップ
        if (window.location.pathname.startsWith('/login') || window.location.pathname.startsWith('/auth')) {
            window.__skipBeforeUnload = true;
        }
        window.addEventListener('beforeunload', event => {
            if (!window.__skipBeforeUnload) {
                navigator.sendBeacon('/api/shutdown');
            }
        });
    </script>
    
    {% block styles %}{% endblock %}
  </head>
  <body>
    
    <div class="container mt-4">
        {% block content %}{% endblock %}
    </div>
    
    {{ bootstrap.load_js() }}
    {% block scripts %}{% endblock %}
  </body>
</html> 