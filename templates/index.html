{% extends "bootstrap/base.html" %}

{% block title %}クラウドワークス案件一覧{% endblock %}

{% block styles %}
{{super()}}
<style>
    .table-container {
        margin-top: 2rem;
        margin-bottom: 2rem;
    }
    .check-column {
        width: 50px;
    }
    .title-column {
        min-width: 300px;
    }
    .budget-column {
        width: 150px;
    }
    .client-column {
        width: 150px;
    }
    .date-column {
        width: 120px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container table-container">
    <h2 class="mb-4">クラウドワークス案件一覧</h2>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="thead-dark">
                <tr>
                    <th class="check-column">確認</th>
                    <th class="title-column">タイトル</th>
                    <th class="budget-column">予算</th>
                    <th class="client-column">クライアント</th>
                    <th class="date-column">投稿日</th>
                </tr>
            </thead>
            <tbody>
                {% for job in jobs %}
                <tr>
                    <td class="check-column">
                        <div class="form-check">
                            <input type="checkbox" 
                                   class="form-check-input job-check" 
                                   data-url="{{ job.url }}"
                                   {% if job.url in checks and checks[job.url].checked %}checked{% endif %}>
                        </div>
                    </td>
                    <td class="title-column">
                        <a href="{{ job.url }}" target="_blank">{{ job.title }}</a>
                    </td>
                    <td class="budget-column">{{ job.budget }}</td>
                    <td class="client-column">{{ job.client }}</td>
                    <td class="date-column">{{ job.posted_date }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{super()}}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('.job-check');
    
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const url = this.dataset.url;
            const checked = this.checked;
            
            fetch('/update_check', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    url: url,
                    checked: checked
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status !== 'success') {
                    console.error('チェック状態の更新に失敗しました');
                    this.checked = !checked;  // 失敗した場合は元の状態に戻す
                }
            })
            .catch(error => {
                console.error('エラー:', error);
                this.checked = !checked;  // エラーの場合は元の状態に戻す
            });
        });
    });
});
</script>
{% endblock %} 